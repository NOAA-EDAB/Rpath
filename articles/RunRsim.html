<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Run a dynamic food web simulation in Rsim • Rpath</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Run a dynamic food web simulation in Rsim">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Rpath</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/Rpath.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-help" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Help</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-help">
<li><a class="dropdown-item" href="../articles/ModelSetup.html">Model setup</a></li>
    <li><a class="dropdown-item" href="../articles/RunRpath.html">Create food web model</a></li>
    <li><a class="dropdown-item" href="../articles/RunRsim.html">Run food web simulation</a></li>
    <li><a class="dropdown-item" href="../articles/ecosense.html">Create an ensemble</a></li>
    <li><a class="dropdown-item" href="../articles/UnitTests.html">Unit testing</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NOAA-EDAB/Rpath/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run a dynamic food web simulation in Rsim</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/Rpath/blob/v1.0.0/vignettes/RunRsim.Rmd" class="external-link"><code>vignettes/RunRsim.Rmd</code></a></small>
      <div class="d-none name"><code>RunRsim.Rmd</code></div>
    </div>

    
    
<p>Rsim is the ecosim implementation of the EwE code in R. In order to
proceed you must have a valid Rpath object. The steps for setting this
up are described in <code><a href="../articles/ModelSetup.html">vignette("ModelSetup")</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REco</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpath.html">rpath</a></span><span class="op">(</span><span class="va">REco.params</span>, eco.name <span class="op">=</span> <span class="st">'R Ecosystem'</span><span class="op">)</span></span></code></pre></div>
<p>Running rsim, is a three part process. First, the function
<code><a href="../reference/rsim.scenario.html">rsim.scenario()</a></code> is run to convert rpath parameters to
rates. Within <code><a href="../reference/rsim.scenario.html">rsim.scenario()</a></code> are 5 functions that
initialize the basic and stanza parameters, creates perturbation
matrices for fishing and other forcing functions, and a list of initial
states. Arguments passed to the <code><a href="../reference/rsim.scenario.html">rsim.scenario()</a></code> function
are the Rpath object, the rpath parameter object, and a vector of years
corresponding to the length of the simulation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REco.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.scenario.html">rsim.scenario</a></span><span class="op">(</span><span class="va">REco</span>, <span class="va">REco.params</span>, years <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>The second part of rsim is to add forcing functions or change the
fishing behavior. This is accomplished by changing the appropriate list
within the <code>REco.sim</code> object created in the first step. There
are a series of adjust functions that will do this without having to
know the specific group numbers. For example, we can double the effort
of the trawler fleet after 25 years using the
<code><a href="../reference/adjust.fishing.html">adjust.fishing()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REco.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust.fishing.html">adjust.fishing</a></span><span class="op">(</span><span class="va">REco.sim</span>, <span class="st">'ForcedEffort'</span>, group <span class="op">=</span> <span class="st">'Trawlers'</span>, sim.year <span class="op">=</span> <span class="fl">25</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>                           value <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The final part is to pass the modified REco.sim object to the
<code><a href="../reference/rsim.run.html">rsim.run()</a></code> function. The only arguments to the
<code><a href="../reference/rsim.run.html">rsim.run()</a></code> function are the Rco.sim object, the method for
numerical integration, and the length of the simulation. Rpath allows
for both Adams-Bashforth and Runge-Kutta 4 numerical integration. Older
versions of EwE use the Adams-Bashforth method while the latest version
(6+) uses Runge-Kutta (The default method for Rpath).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REco.run1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.run.html">rsim.run</a></span><span class="op">(</span><span class="va">REco.sim</span>, method <span class="op">=</span> <span class="st">'RK4'</span>, years <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>The output from <code><a href="../reference/rsim.run.html">rsim.run()</a></code> is another S3 class object.
Similar to the Rpath object created by <code><a href="../reference/rpath.html">rpath()</a></code>, the generic
function <code>print</code> will give output similar to the ‘Ecosim
results’ tab in EwE. If you want to save the <code>print</code> results
you need to use the function <code><a href="../reference/write.Rsim.html">write.Rsim()</a></code>. The function
<code>summary</code> just like for the Rpath object will display what
other list items are available.</p>
<p>For example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">REco.run1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rpath sim results: R Ecosystem </span></span>
<span><span class="co">#&gt;                           Group     StartBio       EndBio     BioES StartCatch</span></span>
<span><span class="co">#&gt; Outside                 Outside 1.000000e+00 1.000000e+00 1.0000000 0.00000000</span></span>
<span><span class="co">#&gt; Seabirds               Seabirds 1.490000e-02 1.654560e-02 1.1104432 0.00001000</span></span>
<span><span class="co">#&gt; Whales                   Whales 4.540000e-01 4.518429e-01 0.9952486 0.00000010</span></span>
<span><span class="co">#&gt; Seals                     Seals 2.500000e-02 9.923369e-03 0.3969347 0.00200000</span></span>
<span><span class="co">#&gt; JuvRoundfish1     JuvRoundfish1 1.304305e-01 1.421985e-01 1.0902247 0.00300000</span></span>
<span><span class="co">#&gt; AduRoundfish1     AduRoundfish1 1.390000e+00 1.417537e+00 1.0198106 0.14500020</span></span>
<span><span class="co">#&gt; JuvRoundfish2     JuvRoundfish2 1.232608e+00 1.189076e+00 0.9646828 0.00300000</span></span>
<span><span class="co">#&gt; AduRoundfish2     AduRoundfish2 5.553000e+00 4.871675e+00 0.8773050 0.38900025</span></span>
<span><span class="co">#&gt; JuvFlatfish1       JuvFlatfish1 6.988442e-02 6.138067e-02 0.8783169 0.00200000</span></span>
<span><span class="co">#&gt; AduFlatfish1       AduFlatfish1 5.766000e+00 4.492539e+00 0.7791431 0.18000021</span></span>
<span><span class="co">#&gt; JuvFlatfish2       JuvFlatfish2 9.628877e-02 4.971856e-02 0.5163485 0.00200000</span></span>
<span><span class="co">#&gt; AduFlatfish2       AduFlatfish2 7.390000e-01 2.358241e-01 0.3191124 0.07000003</span></span>
<span><span class="co">#&gt; OtherGroundfish OtherGroundfish 7.400000e+00 7.456467e+00 1.0076307 0.38000000</span></span>
<span><span class="co">#&gt; Foragefish1         Foragefish1 5.100000e+00 5.302295e+00 1.0396656 0.35100000</span></span>
<span><span class="co">#&gt; Foragefish2         Foragefish2 4.700000e+00 4.896228e+00 1.0417506 0.09100000</span></span>
<span><span class="co">#&gt; OtherForagefish OtherForagefish 5.100000e+00 5.161275e+00 1.0120147 0.03100000</span></span>
<span><span class="co">#&gt; Megabenthos         Megabenthos 1.976538e+01 2.083581e+01 1.0541568 0.19000000</span></span>
<span><span class="co">#&gt; Shellfish             Shellfish 7.000000e+00 6.977903e+00 0.9968433 0.51000000</span></span>
<span><span class="co">#&gt; Macrobenthos       Macrobenthos 1.740000e+01 1.755763e+01 1.0090591 0.00010000</span></span>
<span><span class="co">#&gt; Zooplankton         Zooplankton 2.300000e+01 2.299229e+01 0.9996646 0.00000000</span></span>
<span><span class="co">#&gt; Phytoplankton     Phytoplankton 1.000000e+01 1.000319e+01 1.0003190 0.00000000</span></span>
<span><span class="co">#&gt; Detritus               Detritus 3.636667e+03 3.634375e+03 0.9993697 0.00000000</span></span>
<span><span class="co">#&gt; Discards               Discards 1.218220e+00 1.379414e+00 1.1323194 0.00000000</span></span>
<span><span class="co">#&gt; Trawlers               Trawlers 0.000000e+00 0.000000e+00       NaN 0.00000000</span></span>
<span><span class="co">#&gt; Midwater               Midwater 0.000000e+00 0.000000e+00       NaN 0.00000000</span></span>
<span><span class="co">#&gt; Dredgers               Dredgers 0.000000e+00 0.000000e+00       NaN 0.00000000</span></span>
<span><span class="co">#&gt;                     EndCatch   CatchES</span></span>
<span><span class="co">#&gt; Outside         0.000000e+00       NaN</span></span>
<span><span class="co">#&gt; Seabirds        2.220938e-05 2.2209377</span></span>
<span><span class="co">#&gt; Whales          1.990513e-07 1.9905133</span></span>
<span><span class="co">#&gt; Seals           1.191009e-03 0.5955044</span></span>
<span><span class="co">#&gt; JuvRoundfish1   4.367063e-03 1.4556875</span></span>
<span><span class="co">#&gt; AduRoundfish1   2.342194e-01 1.6153037</span></span>
<span><span class="co">#&gt; JuvRoundfish2   3.865061e-03 1.2883537</span></span>
<span><span class="co">#&gt; AduRoundfish2   6.296491e-01 1.6186342</span></span>
<span><span class="co">#&gt; JuvFlatfish1    2.644912e-03 1.3224560</span></span>
<span><span class="co">#&gt; AduFlatfish1    2.416845e-01 1.3426903</span></span>
<span><span class="co">#&gt; JuvFlatfish2    1.566120e-03 0.7830602</span></span>
<span><span class="co">#&gt; AduFlatfish2    4.151967e-02 0.5931378</span></span>
<span><span class="co">#&gt; OtherGroundfish 6.650567e-01 1.7501492</span></span>
<span><span class="co">#&gt; Foragefish1     3.659638e-01 1.0426318</span></span>
<span><span class="co">#&gt; Foragefish2     9.584120e-02 1.0532000</span></span>
<span><span class="co">#&gt; OtherForagefish 3.238464e-02 1.0446658</span></span>
<span><span class="co">#&gt; Megabenthos     2.002890e-01 1.0541529</span></span>
<span><span class="co">#&gt; Shellfish       5.083903e-01 0.9968438</span></span>
<span><span class="co">#&gt; Macrobenthos    1.009056e-04 1.0090563</span></span>
<span><span class="co">#&gt; Zooplankton     0.000000e+00       NaN</span></span>
<span><span class="co">#&gt; Phytoplankton   0.000000e+00       NaN</span></span>
<span><span class="co">#&gt; Detritus        0.000000e+00       NaN</span></span>
<span><span class="co">#&gt; Discards        0.000000e+00       NaN</span></span>
<span><span class="co">#&gt; Trawlers        0.000000e+00       NaN</span></span>
<span><span class="co">#&gt; Midwater        0.000000e+00       NaN</span></span>
<span><span class="co">#&gt; Dredgers        0.000000e+00       NaN</span></span></code></pre></div>
<p>To export this object to a csv file</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write.Rsim.html">write.Rsim</a></span><span class="op">(</span><span class="va">REco.run1</span>,file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"run1Output.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">REco.run1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rsim parameters for: R Ecosystem </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary Statistics:</span></span>
<span><span class="co">#&gt;   NumGroups NumLiving NumDetritus NumFleets TotBiomassStart TotBiomassEnd</span></span>
<span><span class="co">#&gt; 1        25        20           2         3        3753.822      3750.876</span></span>
<span><span class="co">#&gt;   TotCatchStart TotCatchEnd</span></span>
<span><span class="co">#&gt; 1       2.34911    3.028756</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rpath sim also includes:</span></span>
<span><span class="co">#&gt;  [1] "out_Biomass"     "out_Catch"       "out_Gear_Catch"  "annual_Catch"   </span></span>
<span><span class="co">#&gt;  [5] "annual_Biomass"  "annual_QB"       "annual_Qlink"    "end_state"      </span></span>
<span><span class="co">#&gt;  [9] "crash_year"      "pred"            "prey"            "Gear_Catch_sp"  </span></span>
<span><span class="co">#&gt; [13] "Gear_Catch_gear" "Gear_Catch_disp" "start_state"     "params"</span></span></code></pre></div>
<p>In addition, there is a quick graphical routine for plotting biomass
trajectories over time. Other plots similar to the group plots are
possible but at this time there isn’t a built-in function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rsim.plot.html">rsim.plot</a></span><span class="op">(</span><span class="va">REco.run1</span>, spname<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p><img src="RunRsim_files/figure-html/ecosimEquilibriumPlot-1.png" alt="Biomass Trajectories of all species in model" width="864"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kerim Aydin, Sean Lucey, Sarah Gaichas, Sarah Weisberg, Andy Whitehouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
