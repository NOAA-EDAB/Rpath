<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Unit Tests • Rpath</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Unit Tests">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Rpath</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/Rpath.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ecosense.html">Generating an Rsim ensemble with Ecosense</a></li>
    <li><a class="dropdown-item" href="../articles/ModelSetup.html">Set up a food web model</a></li>
    <li><a class="dropdown-item" href="../articles/RunRpath.html">Create a static food web model in Rpath</a></li>
    <li><a class="dropdown-item" href="../articles/RunRsim.html">Run a dynamic food web simulation in Rsim</a></li>
    <li><a class="dropdown-item" href="../articles/UnitTests.html">Unit Tests</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NOAA-EDAB/Rpath/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Unit Tests</h1>
                        <h4 data-toc-skip class="author">Ron Klasky</h4>
            
            <h4 data-toc-skip class="date">2025-01-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/Rpath/blob/master/vignettes/UnitTests.Rmd" class="external-link"><code>vignettes/UnitTests.Rmd</code></a></small>
      <div class="d-none name"><code>UnitTests.Rmd</code></div>
    </div>

    
    
<p>Source: <code>vignettes/UnitTests.Rmd</code></p>
<div class="section level2">
<h2 id="unit-tests">Unit Tests<a class="anchor" aria-label="anchor" href="#unit-tests"></a>
</h2>
<p>Unit Tests are written using the testthat R package. The tests are
stored in the file: <strong>tests/tests_rpath.R</strong>. They may be
run explicitly by the user clicking the Test or Check buttons under the
Build tab in RStudio. They also run automatically via git actions when
the user does a push or pull request. The output of the unit tests is a
pdf file with a variety of comparison plots, examples of which are given
below in Figures 1-3.</p>
</div>
<div class="section level2">
<h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h2>
<p>Unit Tests consist of comparing a “current” model value (i.e.,
string, table) to a previously stored “baseline” value. Differences are
shown in the testing output as well as reflected in the generated plots
which are written to: <strong>Rplots.pdf</strong>. Difference
“tolerances” are defined by the variable:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TOLERANCE</span> <span class="op">&lt;-</span> <span class="fl">1e-5</span></span></code></pre></div>
<p>which can be modified as necessary.</p>
<div class="section level3">
<h3 id="regenerating-baseline-files">Regenerating Baseline Files<a class="anchor" aria-label="anchor" href="#regenerating-baseline-files"></a>
</h3>
<p>If the user needs to regenerate the baseline files, the following
variable should be set to TRUE and the tests re-run manually (by
clicking the Test button under the Build tab). This will regenerate all
of the baseline data files.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CREATE_BASELINE_FILES</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>After the baseline files have been generated, the user should reset
the variable back:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CREATE_BASELINE_FILES</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="list-of-tests">List of Tests<a class="anchor" aria-label="anchor" href="#list-of-tests"></a>
</h2>
<p>The following unit tests have been developed. Note that some tests
consist of additional/finer tests that compare out_Biomass, out_Catch,
and out_Gear_Catch* for AB (Adams-Bashforth) and RK4 (4th Order Runge
Kutta) numerical differential equation methods.</p>
<div class="section level3">
<h3 id="unit-tests-1">Unit Tests<a class="anchor" aria-label="anchor" href="#unit-tests-1"></a>
</h3>
<details><summary>
Is model balanced?
</summary><ol style="list-style-type: decimal">
<li>Looks for “Balanced” string in Rpath summary file output</li>
</ol></details><details><summary>
Does model run silent?
</summary><ol start="2" style="list-style-type: decimal">
<li>Tests if model runs without producing print statements, warnings, or
error messages.</li>
</ol></details><details><summary>
Compare Rpath summaries
</summary><ol start="3" style="list-style-type: decimal">
<li>Is the baseline Rpath object the same as the current Rpath
object?</li>
</ol></details><details><summary>
Compare Rpath summaries
</summary><ol start="4" style="list-style-type: decimal">
<li>Is the baseline Rpath summary the same as the current Rpath
summary?</li>
</ol></details><details><summary>
Compare baseline AB sim run to current AB sim run
</summary><ol start="5" style="list-style-type: decimal">
<li>Checks if baseline Rpath AB sim run is same as current AB sim run
(checks top level data structure only)<br>
</li>
<li>Compare out_Biomass from baseline and current AB sim runs<br>
</li>
<li>Compare out_Catch from baseline and current AB sim runs<br>
</li>
<li>Compare out_Gear_Catch from baseline and current AB sim
runs<br>
</li>
</ol></details><details><summary>
Compare baseline RK4 sim run to current RK4 sim run
</summary><ol start="9" style="list-style-type: decimal">
<li>Checks if baseline RK4 sim run same as current RK4 sim run (checks
top level data structure only)<br>
</li>
<li>Compare out_Biomass from baseline and current RK4 sim runs<br>
</li>
<li>Compare out_Catch from baseline and current RK4 sim runs<br>
</li>
<li>Compare out_Gear_Catch from baseline and current RK4 sim
runs<br>
</li>
</ol></details><details><summary>
Compare baseline AB sim run to current RK4 sim run
</summary><ol start="13" style="list-style-type: decimal">
<li>Checks if baseline AB sim run same as current RK4 sim run (checks
top level data structure only)<br>
</li>
<li>Compare out_Biomass from baseline AB run and current RK4 sim
run<br>
</li>
<li>Compare out_Catch from baseline AB run and current RK4 sim
run<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current RK4 sim
run<br>
</li>
</ol></details><details><summary>
Compare sim runs with random noise (i.e., jitter) added to
$forcing$ForcedBio
</summary><ol start="17" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
noise added to ForcedBio<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with noise
added to ForcedBio<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
noise added to ForcedBio<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
noise added to ForcedBio<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
noise added to ForcedBio<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with noise added to ForcedBio<br>
</li>
</ol></details><details><summary>
Compare sim runs with random noise (i.e., jitter) added to
$forcing$ForcedMigrate
</summary><ol start="23" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
noise added to ForcedMigrate<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with noise
added to ForcedMigrate<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
noise added to ForcedMigrate<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
noise added to ForcedMigrate<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
noise added to ForcedMigrate<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with noise added to ForcedMigrate<br>
</li>
</ol></details><details><summary>
Compare sim runs with stepped noise added to $forcing$ForcedBio
</summary><ol start="29" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
stepped noise added to ForcedBio<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with
stepped noise added to ForcedBio<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
stepped noise added to ForcedBio<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
stepped noise added to ForcedBio<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
stepped noise added to ForcedBio<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with stepped noise added to ForcedBio<br>
</li>
</ol></details><details><summary>
Compare sim runs with stepped noise added to $forcing$ForcedMigrate
</summary><ol start="35" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
stepped noise added to ForcedMigrate<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with
stepped noise added to ForcedMigrate<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
stepped noise added to ForcedMigrate<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
stepped noise added to ForcedMigrate<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
stepped noise added to ForcedMigrate<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with stepped noise added to ForcedMigrate<br>
</li>
</ol></details><details><summary>
Compare sim runs with random noise (i.e., jitter) added to
$fishing$ForcedEffort
</summary><ol start="41" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
noise added to ForcedEffort<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with noise
added to ForcedEffort<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
noise added to ForcedEffort<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
noise added to ForcedEffort<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
noise added to ForcedEffort<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with noise added to ForcedEffort<br>
</li>
</ol></details><details><summary>
Compare sim runs with random noise (i.e., jitter) added to
$fishing$ForcedFRate
</summary><ol start="47" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
noise added to ForcedFRate<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with noise
added to ForcedFRate<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
noise added to ForcedFRate<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
noise added to ForcedFRate<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
noise added to ForcedFRate<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with noise added to ForcedFRate<br>
</li>
</ol></details><details><summary>
Compare sim runs with random noise (i.e., jitter) added to
$fishing$ForcedCatch
</summary><ol start="53" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
noise added to ForcedCatch<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with noise
added to ForcedCatch<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
noise added to ForcedCatch<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
noise added to ForcedCatch<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
noise added to ForcedCatch<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with noise added to ForcedCatch<br>
</li>
</ol></details><details><summary>
Compare sim runs with stepped noise added to $fishing$ForcedEffort
</summary><ol start="59" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
stepped noise added to ForcedEffort<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with
stepped noise added to ForcedEffort<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
stepped noise added to ForcedEffort<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
stepped noise added to ForcedEffort<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
stepped noise added to ForcedEffort<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with stepped noise added to ForcedEffort<br>
</li>
</ol></details><details><summary>
Compare sim runs with stepped noise added to $fishing$ForcedFRate
</summary><ol start="65" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
stepped noise added to ForcedFRate<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with
stepped noise added to ForcedFRate<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
stepped noise added to ForcedFRate<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
stepped noise added to ForcedFRate<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
stepped noise added to ForcedFRate<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with stepped noise added to ForcedFRate<br>
</li>
</ol></details><details><summary>
Compare sim runs with stepped noise added to $fishing$ForcedCatch
</summary><ol start="71" style="list-style-type: decimal">
<li>Compare out_Biomass from baseline AB run and current AB run with
stepped noise added to ForcedCatch<br>
</li>
<li>Compare out_Catch from baseline AB run and current AB run with
stepped noise added to ForcedCatch<br>
</li>
<li>Compare out_Gear_Catch from baseline AB run and current AB run with
stepped noise added to ForcedCatch<br>
</li>
<li>Compare out_Biomass from baseline RK4 run and current RK4 run with
stepped noise added to ForcedCatch<br>
</li>
<li>Compare out_Catch from baseline RK4 run and current RK4 run with
stepped noise added to ForcedCatch<br>
</li>
<li>Compare out_Gear_Catch from baseline RK4 run and current RK4 run
with stepped noise added to ForcedCatch<br>
</li>
</ol></details><p><br> *The out_Gear_Catch tests are currently awaiting issue #74 to be
resolved.</p>
</div>
</div>
<div class="section level2">
<h2 id="figures">Figures<a class="anchor" aria-label="anchor" href="#figures"></a>
</h2>
<p>The Unit Tests compare current runs with baseline runs and produce
plots in a pdf file. These plots may be useful for diagnostic purposes.
The plots depict the output of a current run in blue and of the baseline
run in red. If there are no errors, then there should be no red visible
on the plots. There are two types of plots available, also set by a
variable in tests/tests_rpath.R:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PLOT_TYPE</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span></code></pre></div>
<p>If PLOT_TYPE is set to 1, then the plot depicts the current model in
blue superimposed over the baseline model in red. If PLOT_TYPE is set to
2, then the difference (current-baseline) is displayed.</p>
</div>
<div class="section level2">
<h2 id="example-plots">Example plots:<a class="anchor" aria-label="anchor" href="#example-plots"></a>
</h2>
<p>Figure 1 depicts an Rpath Simulation run of Biomass Density vs Time
for 3 species. The <code>REcosystem_scene$forcing$ForcedBio</code>
table, where</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">REcosystem_scene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.scenario.html">rsim.scenario</a></span><span class="op">(</span><span class="va">REco</span>, <span class="va">REco.params</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>has been modified with random noise. Both the baseline and current
model runs use the AB (Adams-Bashforth) numerical differential equation
method. Notice that there is no red line visible in this plot. That is,
the current (blue) line is identical (and covers completely) the
baseline (red) plot. <br><br></p>
<div class="figure">
<img src="img%2Fplot_01_no_difference.png" alt="Figure 1. No Difference in Baseline vs Current Models" width="85%:" height="85%"><p class="caption">
Figure 1. No Difference in Baseline vs Current Models
</p>
</div>
<br><br> Figure 2 depicts the same information as Figure 1 with the
difference being that the randomization factor was slightly changed in
the current model from what was used in the baseline model. This was
done to only to highlight how the plot would appear if the current model
deviated from the baseline. Notice that the underlying baseline plot (in
red) is now clearly visible. <br><br><div class="figure">
<img src="img%2Fplot_02_superimposed_with_difference.png" alt="Figure 2. Difference in red of Baseline vs Current Models" width="85%:" height="85%"><p class="caption">
Figure 2. Difference in red of Baseline vs Current Models
</p>
</div>
<p><br><br> Figure 3 shows the difference of the current and baseline
models. If the models were identical, the difference would be 0, and the
plots should be completely flat lines. This plot shows the
current-baseline plots for the data shown in Figure 2. Notice that the
plot lines are not completely flat, denoting that the difference is not
0. The scale of the y-axis may be modified by changing the following
line in <strong>tests/tests_rpath.R</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">YLIMIT_DIFFERENCE_PLOTS</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span></code></pre></div>
<div class="figure">
<img src="img%2Fplot_03_current-baseline.png" alt="Figure 3. Current-Baseline Result" width="85%:" height="85%"><p class="caption">
Figure 3. Current-Baseline Result
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kerim Aydin, Sean Lucey, Sarah Gaichas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
