<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generating an Rsim ensemble with Ecosense • Rpath</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Generating an Rsim ensemble with Ecosense">
<meta property="og:description" content="Rpath">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rpath</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/Rpath.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ecosense.html">Generating an Rsim ensemble with Ecosense</a>
    </li>
    <li>
      <a href="../articles/ModelSetup.html">Set up a food web model</a>
    </li>
    <li>
      <a href="../articles/RunRpath.html">Create a static food web model in Rpath</a>
    </li>
    <li>
      <a href="../articles/RunRsim.html">Run a dynamic food web simulation in Rsim</a>
    </li>
    <li>
      <a href="../articles/UnitTests.html">Unit Tests</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/NOAA-EDAB/Rpath/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Generating an Rsim ensemble with Ecosense</h1>
                        <h4 data-toc-skip class="author">George A.
Whitehouse</h4>
            
            <h4 data-toc-skip class="date">2024-06-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/Rpath/blob/HEAD/vignettes/ecosense.Rmd" class="external-link"><code>vignettes/ecosense.Rmd</code></a></small>
      <div class="hidden name"><code>ecosense.Rmd</code></div>

    </div>

    
    
<p>Rpath is an R implementation of the food web modeling program Ecopath
with Ecosim (EwE; Christensen and Pauly 1992<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, Walters et al. 1997<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>). For full
documentation of the Rpath package see Lucey et al. (2020<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>). Ecosense is a Monte
Carlo approach to generating an ensemble of plausible ecosystem
parameter sets from a single Rpath model for use with
<code>rsim.run</code>, the time-dynamic counterpart to Rpath. For
complete documentation of Ecosense see Whitehouse and Aydin (2020<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>). To use
this vignette it is recommended you are familiar with Rpath and its
basic operations.</p>
<div class="section level2">
<h2 id="ecosense">Ecosense<a class="anchor" aria-label="anchor" href="#ecosense"></a>
</h2>
<p>This vignette includes the example Rpath models from Whitehouse and
Aydin (2020) for the eastern Bering Sea (EBS), eastern Chukchi Sea
(ECS), and Gulf of Alaska (GOA) marine food webs, and uses the EBS model
in an example. Each of these models has 50–54 functional groups,
including one fishery, one primary producer, two detrital compartments,
and there are no stanzas. To use Ecosense you need an
<code>rpath.params</code> object and the corresponding
<code>rsim.scenario</code> object. First, load the unbalanced models,
balance them, and setup the rsim scenario objects.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the unbalanced models</span></span>
<span><span class="co"># load("data/Ecosense.EBS.rda")</span></span>
<span><span class="co"># load("data/Ecosense.ECS.rda")</span></span>
<span><span class="co"># load("data/Ecosense.GOA.rda")</span></span>
<span><span class="co"># balance the models</span></span>
<span><span class="va">EBS_bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpath.html">rpath</a></span><span class="op">(</span><span class="va">Ecosense.EBS</span><span class="op">)</span></span>
<span><span class="va">ECS_bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpath.html">rpath</a></span><span class="op">(</span><span class="va">Ecosense.ECS</span><span class="op">)</span></span>
<span><span class="va">GOA_bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpath.html">rpath</a></span><span class="op">(</span><span class="va">Ecosense.GOA</span><span class="op">)</span></span>
<span><span class="co"># create rsim scenario objects</span></span>
<span><span class="va">EBS_scene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.scenario.html">rsim.scenario</a></span><span class="op">(</span><span class="va">EBS_bal</span>, <span class="va">Ecosense.EBS</span>, years<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">ECS_scene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.scenario.html">rsim.scenario</a></span><span class="op">(</span><span class="va">ECS_bal</span>, <span class="va">Ecosense.ECS</span>, years<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">GOA_scene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.scenario.html">rsim.scenario</a></span><span class="op">(</span><span class="va">GOA_bal</span>, <span class="va">Ecosense.GOA</span>, years<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co"># # source ecosense.R</span></span>
<span><span class="co"># source("R/ecosense.R", local = knitr::knit_global())</span></span>
<span><span class="co"># ls()</span></span></code></pre></div>
<div class="section level3">
<h3 id="setting-up-ecosense">Setting up Ecosense<a class="anchor" aria-label="anchor" href="#setting-up-ecosense"></a>
</h3>
<p>Full sets of Ecosim parameter sets are drawn from distributions
centered on the original Rpath parameter estimates. The width of the
distribution for each parameter is defined in the data pedigree of the
<code>rpath.params</code> object. The drawn parameters include biomass,
P/B, Q/B, diet composition, and natural mortality (i.e., M zero).
Additionally, vulnerability and handling time from the predator prey
functional response can be drawn over a specified range (lower/upper
bounds in log space-1) for each individual predator-prey
interaction.</p>
<p>A single parameter set can be generated with a call to
<code>rsim.sense</code>. The object returned by <code>rsim.sense</code>
is equivalent to the list of parameters in an <code>rsim.scenario</code>
object (e.g., scenario_object$params).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># One set of Ecosim parameters for the EBS model</span></span>
<span><span class="fu"><a href="../reference/rsim.sense.html">rsim.sense</a></span><span class="op">(</span><span class="va">EBS_scene</span>,<span class="va">Ecosense.EBS</span>,Vvary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, Dvary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rsim parameters for  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   NumGroups NumLiving NumDetritus NumFleets</span></span>
<span><span class="co">## 1        54        51           2         1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $params also includes:</span></span>
<span><span class="co">##  [1] "NUM_GROUPS"       "NUM_LIVING"       "NUM_DEAD"         "NUM_GEARS"       </span></span>
<span><span class="co">##  [5] "NUM_BIO"          "spname"           "spnum"            "B_BaseRef"       </span></span>
<span><span class="co">##  [9] "MzeroMort"        "UnassimRespFrac"  "ActiveRespFrac"   "FtimeAdj"        </span></span>
<span><span class="co">## [13] "FtimeQBOpt"       "PBopt"            "NoIntegrate"      "HandleSelf"      </span></span>
<span><span class="co">## [17] "ScrambleSelf"     "PreyFrom"         "PreyTo"           "QQ"              </span></span>
<span><span class="co">## [21] "DD"               "VV"               "HandleSwitch"     "PredPredWeight"  </span></span>
<span><span class="co">## [25] "PreyPreyWeight"   "NumPredPreyLinks" "FishFrom"         "FishThrough"     </span></span>
<span><span class="co">## [29] "FishQ"            "FishTo"           "NumFishingLinks"  "DetFrac"         </span></span>
<span><span class="co">## [33] "DetFrom"          "DetTo"            "NumDetLinks"      "BURN_YEARS"      </span></span>
<span><span class="co">## [37] "COUPLED"          "RK4_STEPS"        "SENSE_LIMIT"</span></span></code></pre>
<p>Each Ecosim parameter set drawn with Ecosense can be subject to an
initial simulation, also known as a burn-in, to eliminate unstable
parameter sets. This instability usually results from incompatible draws
of parameter sets that either lead to uncontrolled population growth or
population crash. Such as predator consumption and production that
exceeds the production of prey. The length of the burn-in period can be
set in the original <code>rsim.scenario</code> object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setting the burn-in period in the EBS scenario object to 50 years.</span></span>
<span><span class="va">EBS_scene</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">BURN_YEARS</span> <span class="op">&lt;-</span> <span class="fl">50</span></span></code></pre></div>
<p>During burn-in, if the biomass of a functional group exceeds 1,000x
its starting biomass or decreases to less than 1/1,000 its starting
biomass, the ecosystem parameter set is rejected and not retained for
further analysis. A 50 year burn-in period is generally sufficient to
eliminate most of the unstable configurations.</p>
</div>
<div class="section level3">
<h3 id="generating-an-ensemble-of-ecosim-parameter-sets">Generating an ensemble of Ecosim parameter sets<a class="anchor" aria-label="anchor" href="#generating-an-ensemble-of-ecosim-parameter-sets"></a>
</h3>
<p>To generate an ensemble of parameter sets you can repeat the call to
<code>rsim.sense</code> in a loop. First, determine the number of
parameter sets you wish to generate and create lists to store those
parameter sets. Set up another vector to keep track of which generated
parameter sets were rejected or retained.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NUM_RUNS</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># how many ecosystem parameter sets to generate</span></span>
<span><span class="va">parlist</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">NUM_RUNS</span><span class="op">)</span><span class="op">)</span> <span class="co"># create lists to store the generated parameters</span></span>
<span><span class="va">kept</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">NUM_RUNS</span><span class="op">)</span> <span class="co"># object to keep track of kept systems</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">666</span><span class="op">)</span> <span class="co"># Optional, set seed so output can be replicated</span></span></code></pre></div>
<p>In this example we will generate 1,000 parameter sets (NUM_RUNS) for
the eastern Bering Sea food web model. parlist[[i]] is the object that
will store the ith generated parameter set. Optionally, you can use
<code>set.seed</code> to replicate these results.</p>
<p>The following loop generates an ensemble of Ecosim parameters for the
EBS food web model, assigns the generated base biomass (B_BaseRef) to
the starting biomass in the <code>rsim.scenario</code> object, sets the
burn years to 50, runs a simulation with <code>rsim.run</code>, and
rejects or retains parameter sets based on the boundaries described
above.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NUM_RUNS</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">EBSsense</span> <span class="op">&lt;-</span> <span class="va">EBS_scene</span> <span class="co"># scenario object</span></span>
<span>  <span class="co"># INSERT SENSE ROUTINE BELOW</span></span>
<span>  <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="va">EBS_scene</span><span class="op">$</span><span class="va">params</span>       <span class="co"># Base ecosim params</span></span>
<span>  <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.sense.html">rsim.sense</a></span><span class="op">(</span><span class="va">EBS_scene</span>,<span class="va">Ecosense.EBS</span>,Vvary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4.5</span>,<span class="fl">4.5</span><span class="op">)</span>, Dvary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># Replace the base params with Ecosense params</span></span>
<span>  <span class="va">EBSsense</span><span class="op">$</span><span class="va">start_state</span><span class="op">$</span><span class="va">Biomass</span> <span class="op">&lt;-</span> <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">B_BaseRef</span> <span class="co"># Apply the Ecosense starting biomass</span></span>
<span>  <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BURN_YEARS</span> <span class="op">&lt;-</span> <span class="fl">50</span>         <span class="co"># Set Burn Years to 50</span></span>
<span>  <span class="va">EBSsense</span><span class="op">$</span><span class="va">params</span> <span class="op">&lt;-</span> <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="co"># replace base params with the Ecosense generated params</span></span>
<span>  <span class="va">EBStest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.run.html">rsim.run</a></span><span class="op">(</span><span class="va">EBSsense</span>, method<span class="op">=</span><span class="st">"AB"</span><span class="op">)</span> <span class="co"># Run rsim with the generated system</span></span>
<span>  <span class="va">failList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">EBStest</span><span class="op">$</span><span class="va">end_state</span><span class="op">$</span><span class="va">Biomass</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">{</span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">failList</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">i</span>,<span class="st">": fail in year "</span>,<span class="va">EBStest</span><span class="op">$</span><span class="va">crash_year</span>,<span class="st">": "</span>,<span class="va">EBStest</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">spname</span><span class="op">[</span><span class="va">failList</span><span class="op">]</span>,<span class="st">"\n"</span><span class="op">)</span>; <span class="va">kept</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&lt;-</span><span class="cn">F</span>; <span class="fu"><a href="https://rdrr.io/r/utils/flush.console.html" class="external-link">flush.console</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span></span>
<span>    <span class="kw">else</span> </span>
<span>    <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">i</span>,<span class="st">": success!\n"</span><span class="op">)</span>; <span class="va">kept</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&lt;-</span><span class="cn">T</span>;  <span class="fu"><a href="https://rdrr.io/r/utils/flush.console.html" class="external-link">flush.console</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span><span class="op">}</span> <span class="co"># output for the console</span></span>
<span>  <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">BURN_YEARS</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This loop produces output in the console noting whether the generated
parameter set was a success or failure, the year the ecosystem
“crashed”, and which group(s) were responsible for the crash. Here are
the results for the first two generated parameter sets:</p>
<p>1 : fail in year 1 : Squids<br>
2 : fail in year 7 : Salmon returning<br></p>
<p>The first two ecosystems both failed, the first in year one and the
second in year seven. Squids crashed in the first ecosystem and Salmon
returning in the second. The 52nd generated parameter set was the first
to survive the 50 year burn-in:</p>
<p>52 : success!<br></p>
<p>To determine which of the 1,000 generated systems survived burn-in,
how many survived burn-in and what the rejection rate was:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">KEPT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">kept</span><span class="op">==</span><span class="cn">T</span><span class="op">)</span>; <span class="va">KEPT</span> <span class="co"># the number associated with the kept system</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  52  68  69  78  85 129 139 163 174 195 216 224 245 267 285 303 327 359 373</span></span>
<span><span class="co">## [20] 378 382 421 447 474 489 546 575 600 613 628 662 705 725 797 813 848 889 890</span></span>
<span><span class="co">## [39] 893 902 903 938 944</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nkept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">KEPT</span><span class="op">)</span>; <span class="va">nkept</span> <span class="co"># how many were kept</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 43</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">nkept</span><span class="op">/</span><span class="va">NUM_RUNS</span><span class="op">)</span> <span class="co"># rejection rate</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.957</span></span></code></pre>
<p>The numbers in KEPT can be used to access the retained parameter sets
in parlist[[i]]. In this example, 43 parameter sets were retained and
the rejection rate for generated parameter sets was 95.7%.</p>
<p>All of the retained Rsim parameter sets can be run through a
simulation with another for loop. This loop subjects each of the 43
retained parameter sets in this example to a 100 year simulation without
any additional perturbations, the first 50 years of which is the burn-in
period.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">KEPT</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># lists for simulated ecosystems</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">0</span>  <span class="co"># counter for simulated ecosystems</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">KEPT</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">EBS_scene</span><span class="op">$</span><span class="va">start_state</span><span class="op">$</span><span class="va">Biomass</span> <span class="op">&lt;-</span> <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">B_BaseRef</span> <span class="co"># set the starting Biomass to the generated values</span></span>
<span>  <span class="va">EBSsense</span> <span class="op">&lt;-</span> <span class="va">EBS_scene</span> <span class="co"># set up the scenario object</span></span>
<span>  <span class="va">EBSsense</span><span class="op">$</span><span class="va">params</span> <span class="op">&lt;-</span> <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="co"># set the params in the scenario object equal to the generated params.</span></span>
<span>  <span class="va">EBSsense</span><span class="op">$</span><span class="va">BURN_YEARS</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="co"># no burn-in period</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># set the number for the simulated ecosystem</span></span>
<span>  <span class="va">ecos</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.run.html">rsim.run</a></span><span class="op">(</span><span class="va">EBSsense</span>,method<span class="op">=</span><span class="st">'AB'</span><span class="op">)</span> <span class="co"># run rsim.run on the generated system</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ecosystem no."</span>,<span class="va">k</span>,<span class="st">"out of"</span>,<span class="va">nkept</span><span class="op">)</span><span class="op">)</span> <span class="co"># progress output to console</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Because biomass can differ greatly between the generated parameter
sets, relative biomass can be used for plotting. This loop calculates
the relative biomass of each group in each system, relative to their
starting biomass, as drawn by Ecosense.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relB_ecos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">KEPT</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># list to output relative biomass</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nkept</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">spname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ecos</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">out_Biomass</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ecos</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">out_Biomass</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">biomass</span> <span class="op">&lt;-</span> <span class="va">ecos</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">out_Biomass</span><span class="op">[</span>, <span class="va">spname</span><span class="op">]</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span></span>
<span>  <span class="va">start.bio</span> <span class="op">&lt;-</span> <span class="va">biomass</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="co"># the drawn starting biomass </span></span>
<span>  <span class="va">start.bio</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">start.bio</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">rel.bio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">isp</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="va">rel.bio</span><span class="op">[</span>, <span class="va">isp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">biomass</span><span class="op">[</span>, <span class="va">isp</span><span class="op">]</span> <span class="op">/</span> <span class="va">start.bio</span><span class="op">[</span><span class="va">isp</span><span class="op">]</span> <span class="co"># biomass relative to biomass at t=1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rel.bio</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">spname</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">relB_ecos</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rel.bio</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here’s an example plot of walleye pollock from all the retained Rsim
parameter sets. First setup a matrix to store the pollock trajectories
from the simulations with the retained parameter sets.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">this_species</span> <span class="op">&lt;-</span> <span class="st">"Walleye pollock"</span></span>
<span><span class="va">plot_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">1200</span>, ncol<span class="op">=</span><span class="va">nkept</span><span class="op">)</span> <span class="co"># matrix of pollock trajectories from all generated systems</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nkept</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot_mat</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">relB_ecos</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">this_species</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then plot all the trajectories:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_col</span> <span class="op">&lt;-</span> <span class="fu">viridis</span><span class="op">(</span><span class="va">nkept</span><span class="op">)</span></span>
<span><span class="co">#layout(matrix(c(1,1,1,1,1,1,2,2), nrow = 1, ncol = 8, byrow = TRUE))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1200</span>, <span class="va">relB_ecos</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">this_species</span><span class="op">]</span>, type<span class="op">=</span><span class="st">'n'</span>, xlab<span class="op">=</span><span class="st">"Months"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Relative biomass"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">plot_mat</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plot_mat</span><span class="op">)</span><span class="op">)</span>, main<span class="op">=</span><span class="va">this_species</span><span class="op">)</span></span>
<span><span class="co"># one line for pollock in each of the generated systems</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nkept</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1200</span>, <span class="va">relB_ecos</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">this_species</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="va">plot_col</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="ecosense_files/figure-html/plottraj-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># distribution of pollock relative biomasses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">plot_mat</span><span class="op">[</span><span class="fl">1200</span>,<span class="op">]</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">plot_mat</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plot_mat</span><span class="op">)</span><span class="op">)</span>, yaxt<span class="op">=</span><span class="st">'n'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">2</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span>, tick<span class="op">=</span><span class="cn">TRUE</span>, labels<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="ecosense_files/figure-html/plottraj-2.png" width="700">
Each line in the left panel is the relative biomass trajectory of
walleye pollock over the 100 year simulation with the retained Rsim
parameter sets.</p>
</div>
<div class="section level3">
<h3 id="run-the-kept-systems-with-a-perturbation">Run the kept systems with a perturbation<a class="anchor" aria-label="anchor" href="#run-the-kept-systems-with-a-perturbation"></a>
</h3>
<p>When working with an ensemble such as this, we are often interested
in doing the same perturbation across all ensemble members to describe a
range of potential outcomes. In this example, we’ll increase the fishing
mortality on walleye pollock using the <code>adjust.fishing</code>
function. The first 50 years of the simulation are the burn-in period.
So, the perturbation is put in place from year 51 to 100, and in this
example we increase walleye pollock fishing mortality by 2X.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecos_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">KEPT</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># lists for simulated ecosystems</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">0</span>  <span class="co"># counter for simulated ecosystems</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">KEPT</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">EBS_scene</span><span class="op">$</span><span class="va">start_state</span><span class="op">$</span><span class="va">Biomass</span> <span class="op">&lt;-</span> <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">B_BaseRef</span> <span class="co"># set the starting Biomass to the generated values</span></span>
<span>  <span class="va">EBSsense</span> <span class="op">&lt;-</span> <span class="va">EBS_scene</span> <span class="co"># set up the scenario object</span></span>
<span>  <span class="va">EBSsense</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust.fishing.html">adjust.fishing</a></span><span class="op">(</span><span class="va">EBSsense</span>, <span class="st">"ForcedFRate"</span>, group<span class="op">=</span><span class="va">this_species</span>, sim.year<span class="op">=</span><span class="fl">51</span><span class="op">:</span><span class="fl">100</span>, value<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># perturb pollock FRate</span></span>
<span>  <span class="va">EBSsense</span><span class="op">$</span><span class="va">params</span> <span class="op">&lt;-</span> <span class="va">parlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="co"># set the params in the scenario object equal to the generated params.</span></span>
<span>  <span class="va">EBSsense</span><span class="op">$</span><span class="va">BURN_YEARS</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="co"># no burn-in period</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># set the number for the simulated ecosystem</span></span>
<span>  <span class="va">ecos_sp</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rsim.run.html">rsim.run</a></span><span class="op">(</span><span class="va">EBSsense</span>,method<span class="op">=</span><span class="st">'AB'</span><span class="op">)</span> <span class="co"># run rsim.run on the generated system</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ecosystem no."</span>, <span class="va">k</span>, <span class="st">"out of"</span>, <span class="va">nkept</span><span class="op">)</span><span class="op">)</span> <span class="co"># progress output to console</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To visualize the results, we use relative biomass again but this time
relative to biomass at the end of the burn-in period (year 50). That is
the point in time where the perturbation began and the point from which
we want to measure any response or change.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relB_ecos_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">KEPT</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nkept</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">spname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ecos_sp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">out_Biomass</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ecos_sp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">out_Biomass</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">biomass</span> <span class="op">&lt;-</span> <span class="va">ecos_sp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">out_Biomass</span><span class="op">[</span>, <span class="va">spname</span><span class="op">]</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span></span>
<span>  <span class="va">start.bio</span> <span class="op">&lt;-</span> <span class="va">biomass</span><span class="op">[</span><span class="fl">600</span>, <span class="op">]</span> <span class="co"># end of burn-in</span></span>
<span>  <span class="va">start.bio</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">start.bio</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">rel.bio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">isp</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="va">rel.bio</span><span class="op">[</span>, <span class="va">isp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">biomass</span><span class="op">[</span>, <span class="va">isp</span><span class="op">]</span> <span class="op">/</span> <span class="va">start.bio</span><span class="op">[</span><span class="va">isp</span><span class="op">]</span> <span class="co"># biomass relative to the end of burn-in biomass</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rel.bio</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">spname</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">relB_ecos_sp</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rel.bio</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Plot the trajectories for walleye pollock from this perturbation.
Note, the x-axis starts at the begining of the perturbation (January of
year 51).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_mat_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">1200</span>, ncol<span class="op">=</span><span class="va">nkept</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nkept</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot_mat_sp</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">relB_ecos_sp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">this_species</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#layout(matrix(c(1,1,1,1,1,1,2,2), nrow = 1, ncol = 8, byrow = TRUE))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">601</span><span class="op">:</span><span class="fl">1200</span>, <span class="va">relB_ecos_sp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">601</span><span class="op">:</span><span class="fl">1200</span>,<span class="va">this_species</span><span class="op">]</span>, type<span class="op">=</span><span class="st">'n'</span>, xlab<span class="op">=</span><span class="st">"Months"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Relative biomass"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">plot_mat_sp</span><span class="op">[</span><span class="fl">601</span><span class="op">:</span><span class="fl">1200</span>,<span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plot_mat_sp</span><span class="op">[</span><span class="fl">601</span><span class="op">:</span><span class="fl">1200</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>, main<span class="op">=</span><span class="va">this_species</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nkept</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">601</span><span class="op">:</span><span class="fl">1200</span>, <span class="va">relB_ecos_sp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">601</span><span class="op">:</span><span class="fl">1200</span>,<span class="va">this_species</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="va">plot_col</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="ecosense_files/figure-html/walleyeplot-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">plot_mat_sp</span><span class="op">[</span><span class="fl">1200</span>,<span class="op">]</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">plot_mat_sp</span><span class="op">[</span><span class="fl">601</span><span class="op">:</span><span class="fl">1200</span>,<span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plot_mat_sp</span><span class="op">[</span><span class="fl">601</span><span class="op">:</span><span class="fl">1200</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ecosense_files/figure-html/walleyeplot-2.png" width="700">
Biomass for walleye pollock decreased in all 43 ecosystems in response
to the perturbation.</p>
<p>Walleye pollock are a nodal species in the eastern Bering Sea food
web and such a perturbation as in this example might illicit a response
from many functional groups across the food web. Here is an example
boxplot of the distribution of biomass outcomes for all the living
functional groups relative to their biomass at the start of the
perturbation.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_perturb_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="va">nkept</span>, ncol<span class="op">=</span><span class="op">(</span><span class="va">EBS_bal</span><span class="op">$</span><span class="va">NUM_LIVING</span><span class="op">+</span><span class="va">EBS_bal</span><span class="op">$</span><span class="va">NUM_DEAD</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nkept</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">sp_perturb_out</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">relB_ecos_sp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1200</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sp_perturb_out</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">relB_ecos_sp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>,<span class="fl">3</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">sp_perturb_out</span>, outline<span class="op">=</span><span class="cn">FALSE</span>, las<span class="op">=</span><span class="fl">2</span>, cex.axis<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">1</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ecosense_files/figure-html/perturb-1.png" width="700"></p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Christensen V, Pauly D (1992) Ecopath II-a software for
balancing steady-state ecosystem models and calculating network
characteristics. Ecol Model 61:169-185. <a href="doi:10.1016/0304-3800(92)90016-8" class="uri">doi:10.1016/0304-3800(92)90016-8</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Walters C, Christensen V, Pauly D (1997) Structuring
dynamic models of exploited ecosystems from trophic mass-balance
assessments. Rev Fish Biol Fish 7:139-172. <a href="doi:10.1023/a:1018479526149" class="uri">doi:10.1023/a:1018479526149</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Lucey SM, Gaichas SK, Aydin KY (2020) Conducting
reproducible ecosystem modeling using the open source mass balance model
Rpath. Ecol Model 427:11. <a href="doi:10.1016/j.ecolmodel.2020.109057" class="uri">doi:10.1016/j.ecolmodel.2020.109057</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Whitehouse GA, Aydin KY (2020) Assessing the sensitivity
of three Alaska marine food webs to perturbations: an example of Ecosim
simulations using Rpath. Ecol Model 429:16. <a href="doi:10.1016/j.ecolmodel.2020.109074" class="uri">doi:10.1016/j.ecolmodel.2020.109074</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kerim Aydin, Sean Lucey, Sarah Gaichas.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
